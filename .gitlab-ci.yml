include:
  remote: https://gitlab-templates.ddbuild.io/libdatadog/include/variables.yml

variables:
  KUBERNETES_SERVICE_ACCOUNT_OVERWRITE: libdatadog
stages:
  - lint

generate_lints_pipeline:
  tags: [ "runner:docker", "platform:amd64" ]
  stage: lint
  when: always
  image: "${DOCKER_IMAGE}"
  artifacts:
    paths:
      - build/gitlab_pipelines.yml
  script: |
    docker buildx bake checks --print | tee targets.json; docker buildx bake gitlab_pipelines --progress=plain
  
lints:
  stage: lint
  trigger:
    include:
      - artifact: build/gitlab_pipelines.yml
        job: generate_lints_pipeline